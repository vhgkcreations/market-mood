<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“Š Market Mood Advisor</title>
  <link rel="icon" href="https://fav.farm/graph" />
  <style>
    :root {
      --bg: #f4f6f9;
      --text: #000;
      --card-bg: white;
    }
    .dark-mode {
      --bg: #111;
      --text: #f4f4f4;
      --card-bg: #1e1e1e;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background: #007acc;
      color: white;
      padding: 1rem;
      width: 100%;
      text-align: center;
    }
    .container {
      max-width: 700px;
      background: var(--card-bg);
      margin: 20px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .card {
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    .up { background-color: #28a745; color: white; }
    .down { background-color: #dc3545; color: white; }
    .neutral { background-color: #ffc107; color: #333; }
    .info { margin: 10px 0; }
    .timestamp {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
    .share-buttons a {
      margin: 0 10px;
      text-decoration: none;
      color: #007acc;
      font-weight: bold;
    }
    .toggle-dark {
      margin-top: 10px;
      cursor: pointer;
      font-size: 14px;
      color: #007acc;
    }
    input[type="text"] {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="marketMoodTitle">ðŸ“Š Market Mood Advisor</h1>
  </header>
  <div class="container">
    <div id="moodCard" class="card neutral">Loading market mood...</div>
    <div id="reasons"></div>
    <div class="info">
      <strong>Enter Manual FII/DII Data:</strong><br/>
      FII Cash: <input type="text" id="fiiCash" placeholder="+1250 or -230" />
      FII Index Futures: <input type="text" id="fiiFut" placeholder="+100 or -50" />
      FII Index Options: <input type="text" id="fiiOpt" placeholder="+500 or -100" />
      FII Stock Futures: <input type="text" id="fiiStock" placeholder="+120 or -200" />
      FII Stock Options: <input type="text" id="fiiOptStock" placeholder="+300 or -100" />
      DII Cash: <input type="text" id="diiCash" placeholder="+400 or -250" />
      <button onclick="updateMood()">Update Market Mood</button>
    </div>
    <div class="timestamp" id="updatedTime">Last updated: --</div>
    <div class="timestamp" id="countdownTimer">Next update in: 30s</div>
    <div class="toggle-dark" onclick="toggleDarkMode()">ðŸŒ˜ Toggle Dark Mode</div>
  </div>

  <script>
    const marketData = {
      dow: { value: 43089.02, change: 507.24 },
      nifty: { value: 25194.00, change: 126.95 },
      crude: { value: 65.25, change: 0.88 },
      usd: { value: 85.95, change: 0.06 },
      vix: { value: 13.27, change: -0.37 }
    };

    function parseValue(val) {
      val = val.trim();
      if (val.startsWith('-')) return parseFloat(val);
      return parseFloat(val.replace('+', '')) || 0;
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function updateMood() {
      const fiiCash = parseValue(document.getElementById("fiiCash").value);
      const fiiFut = parseValue(document.getElementById("fiiFut").value);
      const fiiOpt = parseValue(document.getElementById("fiiOpt").value);
      const fiiStock = parseValue(document.getElementById("fiiStock").value);
      const fiiOptStock = parseValue(document.getElementById("fiiOptStock").value);
      const diiCash = parseValue(document.getElementById("diiCash").value);

      const fiiTotal = fiiCash + fiiFut + fiiOpt + fiiStock + fiiOptStock;
      const reasons = [];
      let mood = "neutral";
      let advice = "âž– Prefer Neutral / Hedge";

      if (marketData.dow.change > 100) mood = "up";
      else if (marketData.dow.change < -100) mood = "down";

      if (fiiTotal > 1000) mood = "up";
      else if (fiiTotal < -1000) mood = "down";

      if (mood === "up") advice = "ðŸ“ˆ Prefer CE";
      else if (mood === "down") advice = "ðŸ“‰ Prefer PE";

      const base = Math.round(marketData.nifty.value / 50) * 50;
      const strike = mood === "up" ? base + 100 : mood === "down" ? base - 100 : base;
      const strikeMsg = `ðŸŽ¯ Suggested Strike: ${strike} ${mood === "up" ? 'CE' : mood === "down" ? 'PE' : 'Hedge'}`;

      reasons.push(`ðŸ“ˆ Dow: ${marketData.dow.value} (${marketData.dow.change})`);
      reasons.push(`ðŸ’¹ Nifty: ${marketData.nifty.value} (${marketData.nifty.change})`);
      reasons.push(`ðŸ›¢ Crude Oil: ${marketData.crude.value} (${marketData.crude.change})`);
      reasons.push(`ðŸ’± USD/INR: â‚¹${marketData.usd.value} (${marketData.usd.change})`);
      reasons.push(`ðŸ“Š India VIX: ${marketData.vix.value} (${marketData.vix.change})`);
      reasons.push(`ðŸ“‹ FII/DII: FII Cash â‚¹${fiiCash}, Index Fut â‚¹${fiiFut}, Index Opt â‚¹${fiiOpt}, Stock Fut â‚¹${fiiStock}, Stock Opt â‚¹${fiiOptStock}, DII â‚¹${diiCash}`);
      reasons.push(`ðŸ“¦ Total FII: â‚¹${fiiTotal}`);
      reasons.push(`ðŸ§  Advice: ${advice}`);
      reasons.push(strikeMsg);

      document.getElementById("moodCard").textContent =
        mood === "up" ? "ðŸ“ˆ Market likely to open higher" :
        mood === "down" ? "ðŸ“‰ Market likely to open lower" :
        "âž– Sideways or Neutral mood";

      document.getElementById("moodCard").className = `card ${mood}`;

      document.getElementById("reasons").innerHTML = reasons.map(r => `<div class="info">âœ… ${r}</div>`).join("");

      document.getElementById("updatedTime").textContent = `Last updated: ${new Date().toLocaleString()}`;
    }

    // Initial call
    updateMood();

    // Auto-refresh logic
    let countdown = 30;
    setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        updateMood();
        countdown = 30;
      }
      document.getElementById("countdownTimer").textContent = `Next update in: ${countdown}s`;
    }, 1000);
  </script>
</body>
</html>
